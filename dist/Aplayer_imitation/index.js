import{createPinia as e,defineStore as a,storeToRefs as t}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';var r={85:(e,a,t)=>{t.r(a),t.d(a,{default:()=>l});var r=t(226),i=t.n(r),o=t(99),n=t.n(o)()(i());n.push([e.id,'.aplayer-control[data-v-625c8d59]{display:flex;align-items:center;gap:1px;flex-shrink:0}.aplayer-control-btn[data-v-625c8d59]{appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0) !important;border:none;padding:0;margin:0;outline:none;width:24px;height:24px;font-size:14px;color:#666;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.aplayer-control-btn[data-v-625c8d59]:hover{color:#b7daff}.aplayer-control-btn.active[data-v-625c8d59]{color:#b7daff}.fa-play[data-v-625c8d59]{width:8.75px}','']);const l=n},99:e=>{e.exports=function(e){var a=[];return a.toString=function(){return this.map(function(a){var t='',r=void 0!==a[5];return a[4]&&(t+='@supports ('.concat(a[4],') {')),a[2]&&(t+='@media '.concat(a[2],' {')),r&&(t+='@layer'.concat(a[5].length>0?' '.concat(a[5]):'',' {')),t+=e(a),r&&(t+='}'),a[2]&&(t+='}'),a[4]&&(t+='}'),t}).join('')},a.i=function(e,t,r,i,o){'string'==typeof e&&(e=[[null,e,void 0]]);var n={};if(r)for(var l=0;l<this.length;l++){var s=this[l][0];null!=s&&(n[s]=!0)}for(var d=0;d<e.length;d++){var p=[].concat(e[d]);r&&n[p[0]]||(void 0!==o&&(void 0===p[5]||(p[1]='@layer'.concat(p[5].length>0?' '.concat(p[5]):'',' {').concat(p[1],'}')),p[5]=o),t&&(p[2]?(p[1]='@media '.concat(p[2],' {').concat(p[1],'}'),p[2]=t):p[2]=t),i&&(p[4]?(p[1]='@supports ('.concat(p[4],') {').concat(p[1],'}'),p[4]=i):p[4]=''.concat(i)),a.push(p))}},a}},178:(e,a,t)=>{var r=t(85);r.__esModule&&(r=r.default),'string'==typeof r&&(r=[[e.id,r,'']]),r.locals&&(e.exports=r.locals);(0,t(424).A)('04f6b394',r,!1,{})},202:(e,a,t)=>{var r=t(567);r.__esModule&&(r=r.default),'string'==typeof r&&(r=[[e.id,r,'']]),r.locals&&(e.exports=r.locals);(0,t(424).A)('4c6cb90a',r,!1,{})},226:e=>{e.exports=function(e){return e[1]}},341:(e,a)=>{a.A=(e,a)=>{const t=e.__vccOpts||e;for(const[e,r]of a)t[e]=r;return t}},424:(e,a,t)=>{function r(e,a){for(var t=[],r={},i=0;i<a.length;i++){var o=a[i],n=o[0],l={id:e+':'+i,css:o[1],media:o[2],sourceMap:o[3]};r[n]?r[n].parts.push(l):t.push(r[n]={id:n,parts:[l]})}return t}t.d(a,{A:()=>y});var i='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!i)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var o={},n=i&&(document.head||document.getElementsByTagName('head')[0]),l=null,s=0,d=!1,p=function(){},c=null,u='data-vue-ssr-id',m='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function y(e,a,t,i){d=t,c=i||{};var n=r(e,a);return v(n),function(a){for(var t=[],i=0;i<n.length;i++){var l=n[i];(s=o[l.id]).refs--,t.push(s)}a?v(n=r(e,a)):n=[];for(i=0;i<t.length;i++){var s;if(0===(s=t[i]).refs){for(var d=0;d<s.parts.length;d++)s.parts[d]();delete o[s.id]}}}}function v(e){for(var a=0;a<e.length;a++){var t=e[a],r=o[t.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](t.parts[i]);for(;i<t.parts.length;i++)r.parts.push(f(t.parts[i]));r.parts.length>t.parts.length&&(r.parts.length=t.parts.length)}else{var n=[];for(i=0;i<t.parts.length;i++)n.push(f(t.parts[i]));o[t.id]={id:t.id,refs:1,parts:n}}}}function h(){var e=document.createElement('style');return e.type='text/css',n.appendChild(e),e}function f(e){var a,t,r=document.querySelector('style['+u+'~="'+e.id+'"]');if(r){if(d)return p;r.parentNode.removeChild(r)}if(m){var i=s++;r=l||(l=h()),a=E.bind(null,r,i,!1),t=E.bind(null,r,i,!0)}else r=h(),a=x.bind(null,r),t=function(){r.parentNode.removeChild(r)};return a(e),function(r){if(r){if(r.css===e.css&&r.media===e.media&&r.sourceMap===e.sourceMap)return;a(e=r)}else t()}}var g,b=(g=[],function(e,a){return g[e]=a,g.filter(Boolean).join('\n')});function E(e,a,t,r){var i=t?'':r.css;if(e.styleSheet)e.styleSheet.cssText=b(a,i);else{var o=document.createTextNode(i),n=e.childNodes;n[a]&&e.removeChild(n[a]),n.length?e.insertBefore(o,n[a]):e.appendChild(o)}}function x(e,a){var t=a.css,r=a.media,i=a.sourceMap;if(r&&e.setAttribute('media',r),c.ssrId&&e.setAttribute(u,a.id),i&&(t+='\n/*# sourceURL='+i.sources[0]+' */',t+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+' */'),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},567:(e,a,t)=>{t.r(a),t.d(a,{default:()=>l});var r=t(226),i=t.n(r),o=t(99),n=t.n(o)()(i());n.push([e.id,'.aplayer[data-v-1409529e]{position:absolute;left:0;bottom:0;z-index:9999;background:#fff;border-radius:0;box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;font-size:12px;line-height:normal;max-width:400px;min-width:300px;transition:all .3s ease}.aplayer.aplayer-narrow[data-v-1409529e]{width:18px;min-width:18px;transform:translateX(-20%)}.aplayer.aplayer-narrow .aplayer-info[data-v-1409529e]{display:none}.aplayer.aplayer-narrow .aplayer-miniswitcher .aplayer-icon[data-v-1409529e]{transform:rotate(0)}.aplayer-body[data-v-1409529e]{display:flex;position:relative;overflow:hidden;height:66px;padding-right:18px}.aplayer-pic[data-v-1409529e]{position:relative;width:66px;height:66px;background-size:cover;background-position:center;transition:all .3s ease;cursor:pointer;flex-shrink:0;overflow:hidden}.aplayer-pic .aplayer-pic-img[data-v-1409529e]{width:100%;height:100%;object-fit:cover;display:block}.aplayer-pic .aplayer-button[data-v-1409529e]{position:absolute;display:flex;align-items:center;justify-content:center;outline:none;cursor:pointer;color:#fff;border-radius:50%;border:2px solid hsla(0,0%,100%,.8);top:50%;left:50%;transform:translate(-50%,-50%);width:30px;height:30px;background:rgba(0,0,0,.2);font-size:16px;transition:all .1s ease-out}.aplayer-pic .aplayer-button[data-v-1409529e]:hover{border-color:#fff}.aplayer-pic .aplayer-button.aplayer-button-playing[data-v-1409529e]{top:auto;left:auto;bottom:6px;right:6px;transform:none;width:20px;height:20px;background:rgba(0,0,0,0);font-size:10px}.aplayer-pic .aplayer-button .fa-play[data-v-1409529e]{text-align:center;height:15px;width:8px;font-size:14px}.aplayer-pic .aplayer-button .fa-pause[data-v-1409529e]{text-align:center;height:10px;width:12px}.aplayer-info[data-v-1409529e]{flex:1;display:flex;flex-direction:column;min-width:0;padding:8px 15px 10px 15px;justify-content:space-between;border-top:1px solid #e9e9e9}.aplayer-info-top[data-v-1409529e]{display:flex;align-items:center;flex-wrap:nowrap}.aplayer-music[data-v-1409529e]{flex:1;overflow:hidden;margin-right:15px;min-width:0}.aplayer-music .aplayer-title[data-v-1409529e]{font-size:14px;font-weight:400;color:#212121;margin:0 0 2px 0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:1.1}.aplayer-music .aplayer-author[data-v-1409529e]{font-size:12px;color:#666;margin:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:1.1}.aplayer-controller[data-v-1409529e]{display:flex;align-items:center;width:100%}.aplayer-time[data-v-1409529e]{display:flex;align-items:center;color:#999;font-size:11px;flex-shrink:0;white-space:nowrap}.aplayer-time .aplayer-time-inner[data-v-1409529e]{margin-right:7px;font-variant-numeric:tabular-nums}.aplayer-time .aplayer-ptime[data-v-1409529e],.aplayer-time .aplayer-dtime[data-v-1409529e]{font-variant-numeric:tabular-nums}.aplayer-order[data-v-1409529e]{background:none;border:none;outline:none;cursor:pointer;color:#999;font-size:11px;padding:0;transition:all .2s ease;width:15px;height:15px;display:flex;align-items:center;justify-content:center;margin:0 1px}.aplayer-order[data-v-1409529e]:hover{color:#b7daff}.aplayer-miniswitcher[data-v-1409529e]{position:absolute;top:0;right:0;bottom:0;height:100%;background:#e6e6e6;width:18px;border-radius:0 2px 2px 0}.aplayer-miniswitcher .aplayer-icon[data-v-1409529e]{height:100%;width:100%;transform:rotate(180deg);transition:all .3s ease;border:none;background-color:rgba(0,0,0,0);outline:none;cursor:pointer;opacity:.8;vertical-align:middle;padding:0;font-size:12px;margin:0;display:inline-block}.aplayer-miniswitcher .aplayer-icon svg[data-v-1409529e]{width:12px;height:12px;fill:#666}@media screen and (max-width:1024px){.aplayer[data-v-1409529e]{max-width:calc(100vw - 40px)}}@media screen and (max-width:768px){.aplayer[data-v-1409529e]{bottom:80% !important;max-width:calc(100vw - 20px);min-width:auto}.aplayer.aplayer-narrow[data-v-1409529e]{bottom:80% !important}}@media screen and (max-width:640px){.aplayer-body[data-v-1409529e]{height:58px}.aplayer-pic[data-v-1409529e]{width:58px;height:58px}.aplayer-info[data-v-1409529e]{padding:7px 12px 9px 12px}}@media screen and (max-width:480px){.aplayer-body[data-v-1409529e]{height:54px}.aplayer-pic .aplayer-author[data-v-1409529e]{font-size:11px}.aplayer-time .aplayer-time-inner[data-v-1409529e]{margin-right:5px}.aplayer-order[data-v-1409529e]{width:13px;height:13px;font-size:10px}}@media screen and (max-width:390px){.aplayer-body[data-v-1409529e]{height:50px}.aplayer-pic[data-v-1409529e]{width:50px;height:50px}.aplayer-info[data-v-1409529e]{padding:4px 10px 6px 10px}.aplayer-music .aplayer-title[data-v-1409529e]{font-size:12px}.aplayer-music .aplayer-author[data-v-1409529e]{font-size:10px}}@media screen and (max-width:320px){.aplayer-body[data-v-1409529e]{height:46px}.aplayer-pic[data-v-1409529e]{width:46px;height:46px}.aplayer-info[data-v-1409529e]{padding:3px 8px 5px 8px}.aplayer-order[data-v-1409529e]{display:none}}','']);const l=n},572:(e,a,t)=>{var r=t(621);r.__esModule&&(r=r.default),'string'==typeof r&&(r=[[e.id,r,'']]),r.locals&&(e.exports=r.locals);(0,t(424).A)('7b9dae76',r,!1,{})},621:(e,a,t)=>{t.r(a),t.d(a,{default:()=>l});var r=t(226),i=t.n(r),o=t(99),n=t.n(o)()(i());n.push([e.id,'.aplayer-bar-wrap[data-v-b5bb32c0]{flex:1;margin-right:7px;padding:4px 0;cursor:pointer}.aplayer-bar[data-v-b5bb32c0]{position:relative;height:2px;width:100%;background:#cdcdcd;cursor:pointer;border-radius:1px}.aplayer-loaded[data-v-b5bb32c0]{position:absolute;left:0;top:0;bottom:0;background:#aaa;height:2px;transition:all .5s ease;width:0;border-radius:1px}.aplayer-played[data-v-b5bb32c0]{position:absolute;left:0;top:0;bottom:0;height:2px;width:0;border-radius:1px;background:#b7daff;transition:all .1s ease}.aplayer-thumb[data-v-b5bb32c0]{position:absolute;top:50%;right:-4px;margin-top:-4px;height:8px;width:8px;border-radius:50%;cursor:pointer;transition:all .3s ease;transform:scale(0);opacity:0;background:#b7daff}.aplayer-bar-wrap:hover .aplayer-thumb[data-v-b5bb32c0]{transform:scale(1);opacity:1}','']);const l=n},634:(e,a,t)=>{var r=t(725);r.__esModule&&(r=r.default),'string'==typeof r&&(r=[[e.id,r,'']]),r.locals&&(e.exports=r.locals);(0,t(424).A)('f75bd6a2',r,!1,{})},641:(e,a,t)=>{t.r(a),t.d(a,{default:()=>l});var r=t(226),i=t.n(r),o=t(99),n=t.n(o)()(i());n.push([e.id,'.aplayer-volume-wrap[data-v-0fbfa83f]{position:relative;display:inline-block;margin-right:7px}.aplayer-volume-button[data-v-0fbfa83f]{background:none;border:none;outline:none;cursor:pointer;color:#999;font-size:11px;padding:0;transition:all .2s ease;width:15px;height:15px;display:flex;align-items:center;justify-content:center}.aplayer-volume-button[data-v-0fbfa83f]:hover{color:#b7daff}.aplayer-volume-bar-wrap[data-v-0fbfa83f]{position:absolute;bottom:15px;right:-3px;width:25px;height:36px;z-index:99;opacity:0;visibility:hidden;transition:all .3s ease-in-out}.aplayer-volume-wrap:hover .aplayer-volume-bar-wrap[data-v-0fbfa83f]{opacity:1;visibility:visible}.aplayer-volume-bar[data-v-0fbfa83f]{position:relative;width:5px;height:100%;background:#aaa;cursor:pointer;margin:0 auto;overflow:hidden;border-radius:2px;-webkit-user-select:none;user-select:none;touch-action:none;-webkit-user-drag:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.aplayer-volume[data-v-0fbfa83f]{position:absolute;bottom:0;right:0;width:5px;transition:all .3s ease;background:#b7daff;height:70%}@media screen and (max-width:768px){.aplayer-volume-wrap[data-v-0fbfa83f]{display:none !important}}','']);const l=n},725:(e,a,t)=>{t.r(a),t.d(a,{default:()=>l});var r=t(226),i=t.n(r),o=t(99),n=t.n(o)()(i());n.push([e.id,'.aplayer-list[data-v-a2dd2a0e]{position:absolute;bottom:100%;left:0;right:0;background:#fff;box-shadow:0 -2px 8px rgba(0,0,0,.1);max-height:0;overflow-y:auto;transition:max-height .5s ease;margin-right:18px}.aplayer-list.aplayer-list-show[data-v-a2dd2a0e]{max-height:300px}.aplayer-list .aplayer-list-ol[data-v-a2dd2a0e]{list-style-type:none;margin:0;padding:0}.aplayer-list .aplayer-list-light[data-v-a2dd2a0e]{position:relative;height:32px;line-height:32px;padding:0 10px;font-size:15px;border-top:1px solid #e9e9e9;cursor:pointer;transition:all .3s ease;overflow:hidden;margin:0;display:flex;align-items:center}.aplayer-list .aplayer-list-light[data-v-a2dd2a0e]:first-child{border-top:none}.aplayer-list .aplayer-list-light[data-v-a2dd2a0e]:hover{background:#efefef}.aplayer-list .aplayer-list-light.aplayer-list-cur[data-v-a2dd2a0e]{background:#e6f3ff !important;border-left:4px solid #258bc9}.aplayer-list .aplayer-list-index[data-v-a2dd2a0e]{color:#666;margin-right:12px;cursor:pointer;width:15px;font-size:14px}.aplayer-list .aplayer-list-title[data-v-a2dd2a0e]{color:#666;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-right:10px;font-size:12px}.aplayer-list .aplayer-list-author[data-v-a2dd2a0e]{color:#ccc;font-size:12px}.aplayer-list[data-v-a2dd2a0e]::-webkit-scrollbar{width:5px}.aplayer-list[data-v-a2dd2a0e]::-webkit-scrollbar-track{background:#f1f1f1}.aplayer-list[data-v-a2dd2a0e]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px}.aplayer-list[data-v-a2dd2a0e]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}@media screen and (max-width:768px){.aplayer-list[data-v-a2dd2a0e]{top:100%;bottom:auto;box-shadow:0 2px 8px rgba(0,0,0,.1)}}','']);const l=n},980:(e,a,t)=>{var r=t(641);r.__esModule&&(r=r.default),'string'==typeof r&&(r=[[e.id,r,'']]),r.locals&&(e.exports=r.locals);(0,t(424).A)('3ce6af0a',r,!1,{})}},i={};function o(e){var a=i[e];if(void 0!==a)return a.exports;var t=i[e]={id:e,exports:{}};return r[e](t,t.exports,o),t.exports}o.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return o.d(a,{a}),a},o.d=(e,a)=>{for(var t in a)o.o(a,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})},o.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),o.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const n=Vue,l=_.memoize(e=>{if(!e||isNaN(e))return{minutes:'00',seconds:'00',full:'00:00'};const a=Math.floor(e/60),t=Math.floor(e%60),r=a.toString().padStart(2,'0'),i=t.toString().padStart(2,'0');return{minutes:r,seconds:i,full:`${r}:${i}`}}),s=(e,a)=>!a||isNaN(a)||e<0||isNaN(e)?0:_.clamp(e/a*100,0,100),d=(e,a)=>{if(e<=1)return 0;const t=_.range(e).filter(e=>e!==a);return _.sample(t)??0};class p{audio;eventListeners=new Map;constructor(){this.audio=new Audio,this.audio.preload='auto',this.bindAudioEvents()}bindAudioEvents(){['play','pause','ended','timeupdate','loadedmetadata','canplay','progress','error'].forEach(e=>{this.audio.addEventListener(e,a=>{this.emit(e,a)})})}on(e,a){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(a)}off(e,a){if(this.eventListeners.has(e))if(a){const t=this.eventListeners.get(e),r=t.indexOf(a);r>-1&&t.splice(r,1)}else this.eventListeners.delete(e)}emit(e,a){const t=this.eventListeners.get(e);t&&t.forEach(e=>e(a))}async loadTrack(e){return new Promise((a,t)=>{this.audio.pause(),this.audio.currentTime=0,this.audio.removeAttribute('src'),this.audio.load(),this.audio.src=e.url;const r=()=>{this.audio.removeEventListener('canplay',r),this.audio.removeEventListener('error',i),a()},i=a=>{this.audio.removeEventListener('canplay',r),this.audio.removeEventListener('error',i),t(new Error(`音频加载失败: ${e.name}`))};this.audio.addEventListener('canplay',r,{once:!0}),this.audio.addEventListener('error',i,{once:!0})})}async play(){if(!(this.audio.readyState>=2))return new Promise((e,a)=>{const t=async()=>{this.audio.removeEventListener('canplay',t);try{await this.audio.play(),e()}catch(e){a(new Error(`播放失败: ${e}`))}};this.audio.addEventListener('canplay',t,{once:!0})});try{await this.audio.play()}catch(e){throw console.error('播放失败:',e),e}}pause(){this.audio.pause()}seek(e){this.audio.currentTime=e}setVolume(e){this.audio.volume=Math.max(0,Math.min(1,e))}get currentTime(){return this.audio.currentTime||0}get duration(){return this.audio.duration||0}get buffered(){const e=this.audio.buffered;return e.length>0?e.end(e.length-1):0}get volume(){return this.audio.volume}get paused(){return this.audio.paused}get ended(){return this.audio.ended}get formattedCurrentTime(){return l(this.currentTime)}get formattedDuration(){return l(this.duration)}destroy(){this.pause(),this.audio.removeAttribute('src'),this.audio.load(),this.eventListeners.clear()}}const c=[{name:'String Theocracy',artist:'Mili',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/String%20Theocracy%EF%BC%88%E7%A5%9E%E6%9D%83%E6%94%BF%E6%B2%BB%E4%B9%8B%E7%BB%B3%EF%BC%89Library%20of%20Ruina%20-%20Mili.mp3',cover:'https://p2.music.126.net/uSA7KUpo8rCGvK5z5VvXiA==/109951167104512763.jpg?param=140y140'},{name:'Sis Puella Magica Orchestra',artist:'Música Melódica',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/Sis%20Puella%20Magica%20Orchestra%20-%20M%C3%BAsica%20Mel%C3%B3dica.mp3',cover:'https://p2.music.126.net/BRkOispUjB7V_lxC990G7A==/109951166086738670.jpg?param=140y140'},{name:'业火的红莲',artist:'逆理的钢琴师',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/%E4%B8%9A%E7%81%AB%E7%9A%84%E7%BA%A2%E8%8E%B2%20-%20%E9%80%86%E7%90%86%E7%9A%84%E9%92%A2%E7%90%B4%E5%B8%88.mp3',cover:'http://p2.music.126.net/LMZ6VWw5hil_odFv6MGYXQ==/109951169607637648.jpg?param=140y140'},{name:'カスカナヒカリ',artist:'藤間仁',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/%E3%82%AB%E3%82%B9%E3%82%AB%E3%83%8A%E3%83%92%E3%82%AB%E3%83%AA%20-%20%E8%97%A4%E9%96%93%E4%BB%81.mp3',cover:'https://cf.mora.jp/contents/package/0000/00000284/0009/354/490/0009354490.200.jpg'},{name:'DEEP (深渊)',artist:'Pianoboy高至豪',url:'http://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/DEEP%20(%E6%B7%B1%E6%B8%8A)%20-%20Pianoboy%E9%AB%98%E8%87%B3%E8%B1%AA.mp3',cover:'https://p1.music.126.net/KS1iNTS-9csOTzew3kFm5w==/109951165414795064.jpg?param=200y200'},{name:'Light Above The Sky',artist:'Delos',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/Light%20Above%20The%20Sky%20-%20Delos.mp3',cover:'https://p2.music.126.net/82DoOe7CoKlkrze7k4gyOQ==/109951163708382315.jpg?param=140y140'},{name:'无人之地',artist:'UM',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/%E6%97%A0%E4%BA%BA%E4%B9%8B%E5%9C%B0%20-%20UM.mp3',cover:'https://p1.music.126.net/ImfmFqhrVtvSi0v7LYSKGQ==/109951169790490991.jpg?param=140y140'},{name:'逆洄',artist:'alpaca咕噜',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/%E9%80%86%E6%B4%84%20-%20alpaca%E5%92%95%E5%99%9C.mp3',cover:'https://p2.music.126.net/BqJv2QRfRm4OS9j0sbWRAg==/109951170257467059.jpg?param=140y140'},{name:'化蝶轻岚境',artist:'MoFeansy沐风',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/%E5%8C%96%E8%9D%B6%E8%BD%BB%E5%B2%9A%E5%A2%83%20-%20MoFeansy%E6%B2%90%E9%A3%8E.mp3',cover:'https://img1.kuwo.cn/star/albumcover/500/s4s24/97/4272800514.png'},{name:'海鸣',artist:'路灰气球',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/%E6%B5%B7%E9%B8%A3%20-%20%E8%B7%AF%E7%81%B0%E6%B0%94%E7%90%83.mp3',cover:'https://p2.music.126.net/YU9RRPiWMFMXRPr-nMY4BQ==/109951168882397092.jpg?param=140y140'},{name:'活着就是一种伟大',artist:'Maple暖枫',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/%E6%B4%BB%E7%9D%80%E5%B0%B1%E6%98%AF%E4%B8%80%E7%A7%8D%E4%BC%9F%E5%A4%A7%20-%20Maple%E6%9A%96%E6%9E%AB.mp3',cover:'http://p1.music.126.net/QeXscV_m8uriJ-rt6EQPZQ==/109951168939820951.jpg?param=140y140'},{name:'Lily',artist:'Binary Haze Interactive/Mili',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/Lily%20-%20Binary%20Haze%20Interactive&Mili.mp3',cover:'https://p2.music.126.net/cCXt0Rbny_HPiEKLNmA6Fw==/109951166057712738.jpg?param=140y140'},{name:'North',artist:'Binary Haze Interactive/Mili',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/North%20-%20Binary%20Haze%20Interactive&Mili.mp3',cover:'https://p2.music.126.net/cCXt0Rbny_HPiEKLNmA6Fw==/109951166057712738.jpg?param=140y140'},{name:'Harmonious',artist:'Binary Haze Interactive/Mili',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/Harmonious%20-%20Binary%20Haze%20Interactive&Mili.mp3',cover:'https://p2.music.126.net/cCXt0Rbny_HPiEKLNmA6Fw==/109951166057712738.jpg?param=140y140'},{name:'Mother - Outro',artist:'Binary Haze Interactive/Mili',url:'https://gitgud.io/yoyo514/elegy-for-the-end/-/raw/master/music/Mother%20-%20Outro%20-%20Binary%20Haze%20Interactive&Mili.mp3',cover:'https://p2.music.126.net/cCXt0Rbny_HPiEKLNmA6Fw==/109951166057712738.jpg?param=140y140'}];var u,m,y;!function(e){e.LIST='list',e.RANDOM='random',e.REPEAT_ONE='repeat-one',e.NONE='none'}(u||(u={})),function(e){e.PLAY='play',e.PAUSE='pause',e.ENDED='ended',e.TIME_UPDATE='timeupdate',e.LOADED_METADATA='loadedmetadata',e.CAN_PLAY='canplay',e.PROGRESS='progress',e.ERROR='error'}(m||(m={})),function(e){e.UNLOADED='unloaded',e.LOADING='loading',e.LOADED='loaded',e.ERROR='error'}(y||(y={}));const v=a('player',()=>{const e=(0,n.ref)([...c]),a=(0,n.ref)(0),t=(0,n.ref)(!1),r=(0,n.ref)(.7),i=(0,n.ref)(.7),o=(0,n.ref)(u.LIST),l=(0,n.ref)(!1),s=(0,n.ref)(!0),p=(0,n.ref)(!1),m=(0,n.ref)(0),y=(0,n.ref)(0),v=(0,n.ref)(0),h=(0,n.computed)(()=>e.value[a.value]||null),f=(0,n.computed)(()=>e.value.length>1),g=(0,n.computed)(()=>e.value.length>1),b=(0,n.computed)(()=>y.value?m.value/y.value*100:0),E=(0,n.computed)(()=>y.value?v.value/y.value*100:0),x=(0,n.computed)(()=>0===r.value),w=(0,n.computed)(()=>({currentIndex:a.value,isPlaying:t.value,volume:r.value,previousVolume:i.value,order:o.value,isMinimized:l.value,listFolded:s.value,currentTime:m.value,duration:y.value,buffered:v.value})),A=t=>{t>=0&&t<e.value.length&&(a.value=t)},N=e=>{t.value=e},k=e=>{const a=Math.max(0,Math.min(1,e));r.value>0&&(i.value=r.value),r.value=a},S=e=>{m.value=e},P=e=>{y.value=e},B=e=>{v.value=e},R=()=>{switch(o.value){case u.RANDOM:return d(e.value.length,a.value);case u.REPEAT_ONE:return a.value;case u.NONE:return a.value>=e.value.length-1?a.value:a.value+1;case u.LIST:default:return(a.value+1)%e.value.length}},O=()=>{switch(o.value){case u.RANDOM:return d(e.value.length,a.value);case u.REPEAT_ONE:return a.value;case u.NONE:return a.value<=0?a.value:a.value-1;case u.LIST:default:return 0===a.value?e.value.length-1:a.value-1}};return{audioList:e,currentIndex:a,isPlaying:t,volume:r,previousVolume:i,order:o,isMinimized:l,listFolded:s,autoPlay:p,currentTime:m,duration:y,buffered:v,currentTrack:h,canSkipPrev:f,canSkipNext:g,progress:b,bufferedProgress:E,isMuted:x,playerState:w,setAudioList:t=>{e.value=[...t],a.value>=t.length&&(a.value=0)},setCurrentIndex:A,setPlaying:N,setVolume:k,toggleMute:()=>{r.value>0?k(0):k(i.value>0?i.value:1)},setOrder:e=>{o.value=e},toggleMinimized:()=>{l.value=!l.value},toggleList:()=>{s.value=!s.value},updateTime:S,updateDuration:P,updateBuffered:B,getNextIndex:R,getPrevIndex:O,skipToNext:()=>{const e=R();o.value!==u.NONE||e!==a.value?A(e):N(!1)},skipToPrev:()=>{const e=O();o.value!==u.NONE||e!==a.value?A(e):N(!1)},switchTo:e=>{A(e)},reset:()=>{N(!1),S(0),P(0),B(0)},initFromSettings:t=>{void 0!==t.defaultVolume&&(r.value=t.defaultVolume,i.value=t.defaultVolume),void 0!==t.defaultOrder&&(o.value=t.defaultOrder),void 0!==t.listFolded&&(s.value=t.listFolded),void 0!==t.isMinimized&&(l.value=t.isMinimized),void 0!==t.autoPlay&&(p.value=t.autoPlay),t.customAudioList&&Array.isArray(t.customAudioList)&&t.customAudioList.length>0&&(e.value=[...t.customAudioList],a.value>=t.customAudioList.length&&(a.value=0))},saveCurrentSettings:()=>{const a={defaultVolume:r.value,defaultOrder:o.value,autoPlay:p.value,listFolded:s.value,isMinimized:l.value,customAudioList:e.value};try{replaceVariables(a,{type:'script',script_id:getScriptId()})}catch(e){console.warn('[APlayer] 保存设置失败:',e)}}}});var h,f;!function(e){e.AUDIO_LOAD_ERROR='audio_load_error',e.AUDIO_PLAY_ERROR='audio_play_error',e.NETWORK_ERROR='network_error',e.PERMISSION_ERROR='permission_error',e.UNKNOWN_ERROR='unknown_error'}(h||(h={})),function(e){e.IDLE='idle',e.LOADING='loading',e.SUCCESS='success',e.ERROR='error'}(f||(f={}));class g{maxRetries;retryDelay;constructor(e=3,a=1e3){this.maxRetries=e,this.retryDelay=a}async execute(e,a){let t;for(let r=1;r<=this.maxRetries;r++)try{return await e()}catch(e){t=e,r<this.maxRetries&&(a?.(r,e),await this.delay(this.retryDelay*Math.pow(2,r-1)))}throw t}delay(e){return new Promise(a=>setTimeout(a,e))}}const b={class:'aplayer-control'},E=['disabled'],x=['title'],w={class:'fas fa-play'},A={class:'fas fa-pause'},N=['disabled'],k=(0,n.defineComponent)({__name:'PlayerControls',props:{isPlaying:{type:Boolean},canSkipPrev:{type:Boolean},canSkipNext:{type:Boolean}},emits:['play','pause','prev','next','toggle-list'],setup:e=>(e,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',b,[(0,n.createElementVNode)('button',{class:'aplayer-prev aplayer-control-btn',disabled:!e.canSkipPrev,title:'上一首',onClick:a[0]||(a[0]=a=>e.$emit('prev'))},[...a[4]||(a[4]=[(0,n.createElementVNode)('i',{class:'fas fa-step-backward'},null,-1)])],8,E),(0,n.createElementVNode)('button',{class:'aplayer-play-btn aplayer-control-btn',title:e.isPlaying?'暂停':'播放',onClick:a[1]||(a[1]=a=>e.isPlaying?e.$emit('pause'):e.$emit('play'))},[(0,n.withDirectives)((0,n.createElementVNode)('i',w,null,512),[[n.vShow,!e.isPlaying]]),(0,n.withDirectives)((0,n.createElementVNode)('i',A,null,512),[[n.vShow,e.isPlaying]])],8,x),(0,n.createElementVNode)('button',{class:'aplayer-next aplayer-control-btn',disabled:!e.canSkipNext,title:'下一首',onClick:a[2]||(a[2]=a=>e.$emit('next'))},[...a[5]||(a[5]=[(0,n.createElementVNode)('i',{class:'fas fa-step-forward'},null,-1)])],8,N),(0,n.createElementVNode)('button',{class:'aplayer-menu aplayer-control-btn',title:'菜单',onClick:a[3]||(a[3]=a=>e.$emit('toggle-list'))},[...a[6]||(a[6]=[(0,n.createElementVNode)('i',{class:'fas fa-bars'},null,-1)])])]))});o(178);var S=o(341);const P=(0,S.A)(k,[['__scopeId','data-v-625c8d59']]),B={class:'aplayer-list-ol'},R=['onClick'],O={class:'aplayer-list-index'},M={class:'aplayer-list-title'},V={class:'aplayer-list-author'},C=(0,n.defineComponent)({__name:'PlayList',props:{tracks:{},currentIndex:{},isVisible:{type:Boolean}},emits:['select-track'],setup:e=>(e,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{class:(0,n.normalizeClass)(['aplayer-list',{'aplayer-list-show':e.isVisible}])},[(0,n.createElementVNode)('ol',B,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.tracks,(a,t)=>((0,n.openBlock)(),(0,n.createElementBlock)('li',{key:`track-${t}-${a.name}`,class:(0,n.normalizeClass)(['aplayer-list-light',{'aplayer-list-cur':t===e.currentIndex}]),onClick:a=>e.$emit('select-track',t)},[(0,n.createElementVNode)('span',O,(0,n.toDisplayString)(t+1),1),(0,n.createElementVNode)('span',M,(0,n.toDisplayString)(a.name),1),(0,n.createElementVNode)('span',V,(0,n.toDisplayString)(a.artist),1)],10,R))),128))])],2))});o(634);const T=(0,S.A)(C,[['__scopeId','data-v-a2dd2a0e']]),L=(0,n.defineComponent)({__name:'ProgressBar',props:{currentTime:{},duration:{},buffered:{}},emits:['seek'],setup(e,{emit:a}){const t=e,r=a,i=(0,n.ref)(),o=(0,n.computed)(()=>s(t.currentTime,t.duration)),l=(0,n.computed)(()=>s(t.buffered,t.duration)),d=e=>{if(!i.value||!t.duration)return;const a=i.value.getBoundingClientRect(),o=(e.clientX-a.left)/a.width*t.duration;r('seek',Math.max(0,Math.min(t.duration,o)))};return(e,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{class:'aplayer-bar-wrap',onClick:d},[(0,n.createElementVNode)('div',{class:'aplayer-bar',ref_key:'barRef',ref:i},[(0,n.createElementVNode)('div',{class:'aplayer-loaded',style:(0,n.normalizeStyle)({width:`${l.value}%`})},null,4),(0,n.createElementVNode)('div',{class:'aplayer-played',style:(0,n.normalizeStyle)({width:`${o.value}%`})},[...a[0]||(a[0]=[(0,n.createElementVNode)('span',{class:'aplayer-thumb'},null,-1)])],4)],512)]))}});o(572);const D=(0,S.A)(L,[['__scopeId','data-v-b5bb32c0']]),I={class:'aplayer-volume-wrap'},j={class:'aplayer-volume-bar-wrap'},F=(0,n.defineComponent)({__name:'VolumeControl',props:{volume:{},isMuted:{type:Boolean}},emits:['volume-change','toggle-mute'],setup(e,{emit:a}){const t=e,r=a,i=(0,n.ref)(),o=(0,n.ref)(!1),l=(0,n.computed)(()=>100*t.volume),s=(0,n.computed)(()=>t.isMuted||0===t.volume?'fas fa-volume-off':t.volume>.5?'fas fa-volume-up':'fas fa-volume-down'),d=e=>{if(!i.value)return;const a=i.value.getBoundingClientRect(),t=a.height-10,o=e.clientY-a.top-5;let n;n=o<=0?1:o>=t?0:1-o/t;const l=Math.max(0,Math.min(1,n));r('volume-change',l)},p=e=>{o.value||(e.stopPropagation(),d(e))},c=e=>{if(!i.value)return;e.preventDefault(),e.stopPropagation(),o.value=!0,d(e);$(document).on('mousemove.volumeControl',e=>{if(!o.value)return;const a=e.originalEvent;d(a)}),$(document).on('mouseup.volumeControl',()=>{o.value=!1,$(document).off('mousemove.volumeControl mouseup.volumeControl'),setTimeout(()=>{o.value=!1},10)})};return(e,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('span',I,[(0,n.createElementVNode)('button',{class:'aplayer-volume-button',onClick:a[0]||(a[0]=a=>e.$emit('toggle-mute'))},[(0,n.createElementVNode)('i',{class:(0,n.normalizeClass)(s.value)},null,2)]),(0,n.createElementVNode)('div',j,[(0,n.createElementVNode)('div',{class:'aplayer-volume-bar',ref_key:'volumeBarRef',ref:i,onMousedown:c,onClick:p},[(0,n.createElementVNode)('div',{class:'aplayer-volume',style:(0,n.normalizeStyle)({height:`${l.value}%`})},null,4)],544)])]))}});o(980);const U=(0,S.A)(F,[['__scopeId','data-v-0fbfa83f']]),G={class:'aplayer-body'},H={class:'fas fa-play'},K={class:'fas fa-pause'},W=['src','alt'],X={class:'aplayer-info'},Y={class:'aplayer-info-top'},Q={class:'aplayer-music'},q={class:'aplayer-title'},J={class:'aplayer-author'},Z={class:'aplayer-controller'},ee={class:'aplayer-time'},ae={class:'aplayer-time-inner'},te={class:'aplayer-ptime'},re={class:'aplayer-dtime'},ie=['title'],oe=(0,n.defineComponent)({__name:'MusicPlayer',setup(e){const a=v(),{audioList:r,currentIndex:i,isPlaying:o,volume:s,order:d,isMinimized:c,listFolded:y,autoPlay:b,currentTime:E,duration:x,buffered:w,canSkipPrev:A,canSkipNext:N,isMuted:k}=t(a);let S,B;const R=(()=>{const e=(0,n.ref)([]),a=(0,n.ref)(null),t=(0,n.ref)(f.IDLE),r=_.throttle(t=>{const r={...t,timestamp:Date.now()};e.value.unshift(r),a.value=r,e.value.length>10&&(e.value=e.value.slice(0,10)),setTimeout(()=>{a.value===r&&(a.value=null)},5e3),console.error('[APlayer Error]',r)},1e3),i=e=>{t.value=e};return{errors:e,currentError:a,loadingState:t,addError:r,clearCurrentError:()=>{a.value=null},clearAllErrors:()=>{e.value=[],a.value=null},setLoadingState:i,handleAudioLoadError:(e,a,t)=>{let o='音频加载失败',n=h.AUDIO_LOAD_ERROR;t&&(t.message?.includes('network')?(n=h.NETWORK_ERROR,o='网络连接失败，无法加载音频'):t.message?.includes('permission')&&(n=h.PERMISSION_ERROR,o='没有权限播放该音频')),r({type:n,message:`${o}: ${e}`,trackName:e,trackUrl:a}),i(f.ERROR)},handleAudioPlayError:(e,a)=>{let t='音频播放失败';a&&('NotAllowedError'===a.name?t='播放被浏览器阻止，请手动点击播放按钮':'NotSupportedError'===a.name&&(t='该音频格式不受支持')),r({type:h.AUDIO_PLAY_ERROR,message:`${t}: ${e}`,trackName:e})},handleNetworkError:(e='网络连接失败')=>{r({type:h.NETWORK_ERROR,message:e})},handleUnknownError:(e,a='未知操作')=>{r({type:h.UNKNOWN_ERROR,message:`${a}时发生未知错误: ${e?.message||'未知错误'}`})}}})(),{handleAudioLoadError:O,handleAudioPlayError:M,setLoadingState:V}=R,C=(0,n.ref)(''),L=(0,n.ref)(!1),I=(0,n.computed)(()=>l(E.value).full),j=(0,n.computed)(()=>l(x.value).full),F=(0,n.computed)(()=>a.currentTrack),oe=(0,n.computed)(()=>{switch(d.value){case u.LIST:return'列表循环';case u.RANDOM:return'随机播放';case u.REPEAT_ONE:return'单曲循环';case u.NONE:return'播完停止';default:return'列表循环'}}),ne=(0,n.computed)(()=>{switch(d.value){case u.RANDOM:return'fas fa-random';case u.REPEAT_ONE:return'fas fa-redo-alt';case u.NONE:return'fas fa-arrow-right';default:return'fas fa-retweet'}}),le=async()=>{const e=a.currentTrack;if(e)try{C.value===e.url&&0!==S.duration||(console.log('[APlayer] 播放前检测到音频未加载，先加载音频'),await pe()),V(f.LOADING),await B.execute(()=>S.play(),(e,a)=>{console.warn(`播放重试 ${e}/3:`,a)}),a.setPlaying(!0),V(f.SUCCESS),console.log('[APlayer] 播放成功:',e.name)}catch(t){console.error('[APlayer] 播放失败:',t),M(e.name,t),a.setPlaying(!1),V(f.ERROR)}},se=()=>{S.pause(),a.setPlaying(!1),console.log('[APlayer] 已暂停播放')},de=()=>{o.value?se():le()},pe=async()=>{const e=a.currentTrack;if(e&&!L.value)if(C.value!==e.url){L.value=!0,console.log('[APlayer] 开始加载音频:',e.name,e.url);try{V(f.LOADING),a.updateTime(0),a.updateDuration(0),a.updateBuffered(0),await B.execute(()=>S.loadTrack(e),(a,t)=>{console.warn(`音频加载重试 ${a}/3:`,e?.name,t)}),C.value=e.url,V(f.SUCCESS),console.log('[APlayer] 音频加载成功:',e.name)}catch(a){console.error('[APlayer] 加载音频失败:',a),O(e.name,e.url,a),V(f.ERROR),C.value='',setTimeout(()=>me(),1500)}finally{L.value=!1}}else console.log('[APlayer] 音频已加载，跳过重复加载:',e.name)},ce=async(e=!1)=>{const t=a.currentTrack;t&&(console.log('[APlayer] 开始切换歌曲到:',t.name),se(),C.value='',await pe(),e&&await le())},ue=async()=>{const e=o.value;console.log('[APlayer] 点击上一首，当前播放状态:',e),a.skipToPrev(),await ce(e)},me=async()=>{const e=o.value;console.log('[APlayer] 点击下一首，当前播放状态:',e),a.skipToNext(),await ce(e)},ye=async e=>{const t=o.value;console.log('[APlayer] 选择歌曲索引:',e,'当前播放状态:',t),console.log('[APlayer] 选择的歌曲:',r.value[e]?.name),a.switchTo(e),await ce(t)},ve=e=>{S.duration>0?S.seek(e):console.warn('[APlayer] 无法快进，音频尚未加载完成')},he=e=>{a.setVolume(e),S.setVolume(e)},fe=()=>{a.toggleMute(),S.setVolume(s.value)},ge=()=>{const e=[u.LIST,u.RANDOM,u.REPEAT_ONE,u.NONE],t=e.indexOf(d.value),r=e[(t+1)%e.length];a.setOrder(r)},be=()=>{a.toggleList()},Ee=()=>{a.toggleMinimized()},xe=async()=>{switch(d.value){case u.REPEAT_ONE:S.seek(0),await le();break;case u.NONE:se();break;case u.RANDOM:case u.LIST:default:a.skipToNext(),await ce(!0)}};return(0,n.onMounted)(()=>{S=new p,B=new g(3,1e3),S.on(m.TIME_UPDATE,()=>{a.updateTime(S.currentTime)}),S.on(m.LOADED_METADATA,()=>{a.updateDuration(S.duration)}),S.on(m.PROGRESS,()=>{a.updateBuffered(S.buffered)}),S.on(m.ENDED,xe),S.on(m.ERROR,e=>{console.error('[APlayer] 音频播放错误:',e),F.value&&O(F.value.name,F.value.url,e),setTimeout(()=>me(),1500)}),S.setVolume(s.value),F.value&&pe().then(()=>{b.value&&le()})}),(0,n.onUnmounted)(()=>{S&&S.destroy()}),(0,n.watch)(i,async(e,a)=>{e!==a&&S&&(C.value='',await pe())},{immediate:!1}),(0,n.watch)(s,e=>{S&&S.setVolume(e)}),(e,a)=>((0,n.openBlock)(),(0,n.createElementBlock)('div',{class:(0,n.normalizeClass)(['aplayer',{'aplayer-narrow':(0,n.unref)(c)}])},[(0,n.createCommentVNode)(' 播放列表 '),(0,n.createVNode)(T,{tracks:(0,n.unref)(r),'current-index':(0,n.unref)(i),'is-visible':!(0,n.unref)(y),onSelectTrack:ye},null,8,['tracks','current-index','is-visible']),(0,n.createElementVNode)('div',G,[(0,n.createCommentVNode)(' 封面和播放按钮 '),(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['aplayer-pic',{'aplayer-pic-playing':(0,n.unref)(o)}]),onClick:de},[(0,n.createElementVNode)('div',{class:(0,n.normalizeClass)(['aplayer-button',{'aplayer-button-playing':(0,n.unref)(o)}])},[(0,n.withDirectives)((0,n.createElementVNode)('i',H,null,512),[[n.vShow,!(0,n.unref)(o)]]),(0,n.withDirectives)((0,n.createElementVNode)('i',K,null,512),[[n.vShow,(0,n.unref)(o)]])],2),(0,n.createElementVNode)('img',{class:'aplayer-pic-img',src:F.value?.cover,alt:F.value?.name||'封面'},null,8,W)],2),(0,n.createCommentVNode)(' 播放信息和控制 '),(0,n.createElementVNode)('div',X,[(0,n.createElementVNode)('div',Y,[(0,n.createCommentVNode)(' 歌曲信息 '),(0,n.createElementVNode)('div',Q,[(0,n.createElementVNode)('span',q,(0,n.toDisplayString)(F.value?.name||'未知歌曲'),1),(0,n.createElementVNode)('span',J,' - '+(0,n.toDisplayString)(F.value?.artist||'未知艺术家'),1)]),(0,n.createCommentVNode)(' 控制按钮 '),(0,n.createVNode)(P,{'is-playing':(0,n.unref)(o),'can-skip-prev':(0,n.unref)(A),'can-skip-next':(0,n.unref)(N),onPlay:le,onPause:se,onPrev:ue,onNext:me,onToggleList:be},null,8,['is-playing','can-skip-prev','can-skip-next'])]),(0,n.createElementVNode)('div',Z,[(0,n.createCommentVNode)(' 进度条 '),(0,n.createVNode)(D,{'current-time':(0,n.unref)(E),duration:(0,n.unref)(x),buffered:(0,n.unref)(w),onSeek:ve},null,8,['current-time','duration','buffered']),(0,n.createCommentVNode)(' 时间和音量 '),(0,n.createElementVNode)('div',ee,[(0,n.createElementVNode)('span',ae,[(0,n.createElementVNode)('span',te,(0,n.toDisplayString)(I.value),1),a[0]||(a[0]=(0,n.createTextVNode)(' / ',-1)),(0,n.createElementVNode)('span',re,(0,n.toDisplayString)(j.value),1)]),(0,n.createVNode)(U,{volume:(0,n.unref)(s),'is-muted':(0,n.unref)(k),onVolumeChange:he,onToggleMute:fe},null,8,['volume','is-muted']),(0,n.createElementVNode)('button',{class:'aplayer-order',title:oe.value,onClick:ge},[(0,n.createElementVNode)('i',{class:(0,n.normalizeClass)(ne.value)},null,2)],8,ie)])])]),(0,n.createCommentVNode)(' 收缩/展开按钮 '),(0,n.createElementVNode)('div',{class:'aplayer-miniswitcher'},[(0,n.createElementVNode)('button',{class:'aplayer-icon',onClick:Ee},[...a[1]||(a[1]=[(0,n.createElementVNode)('svg',{xmlns:'http://www.w3.org/2000/svg',version:'1.1',viewBox:'0 0 32 32'},[(0,n.createElementVNode)('path',{d:'M22 16l-10.105-10.6-1.895 1.987 8.211 8.613-8.211 8.612 1.895 1.988 8.211-8.613z'})],-1)])])])])],2))}});o(202);const ne=(0,S.A)(oe,[['__scopeId','data-v-1409529e']]),le=z.object({defaultVolume:z.number().min(0).max(1).default(.7),defaultOrder:z.enum(u).default(u.LIST),autoPlay:z.boolean().default(!1),listFolded:z.boolean().default(!0),isMinimized:z.boolean().default(!1),customAudioList:z.array(z.object({name:z.string(),artist:z.string(),url:z.url(),cover:z.url().optional()})).optional()});class se{static instance=null;playerApp=null;container=null;piniaInstance=null;constructor(){this.bindGlobalEvents()}static getInstance(){return this.instance??=new se,this.instance}createPlayer=_.once((e=c)=>{try{this.cleanup(),this.initializeContainer(),this.createVueApplication(),this.handleStyleInjection(),this.applyUserSettings(),console.log('[APlayer] 播放器创建成功')}catch(e){this.handleError('创建播放器',e)}});destroyPlayer(){this.cleanup(),this.resetInstance(),console.log('[APlayer] 播放器已销毁')}initializeContainer(){$('#aplayer-container').length?this.container=$('#aplayer-container'):(this.container=$('<div>').attr('id','aplayer-container'),$('body').append(this.container))}createVueApplication(){this.piniaInstance=e(),this.playerApp=(0,n.createApp)(ne),this.playerApp.use(this.piniaInstance),this.playerApp.mount(this.container[0])}handleStyleInjection=_.debounce(()=>{const e=this.findScopeIds();this.injectStyles(e)},150);findScopeIds(){const e=new Set;return this.container?.find('div').each(function(){this.getAttributeNames().forEach(a=>{a.startsWith('data-v-')&&e.add(a)})}),e}injectStyles(e){0!==e.size?(console.log(`[APlayer] 发现 ${e.size} 个组件样式:`,Array.from(e)),e.forEach(e=>{const a=de.findStyleElement(e);a.length?(this.container.append(a),console.log(`[APlayer] 成功注入样式: ${e}`)):console.warn(`[APlayer] 未找到 ${e} 对应的样式标签。`)})):console.warn('[APlayer] 未找到任何组件的 scoped 样式属性。')}applyUserSettings(){try{const e=getVariables({type:'script',script_id:getScriptId()}),a=de.processSettings(e);this.applySettingsToStore(a),console.log('[APlayer] 已加载播放器设置:',a)}catch(e){console.warn('[APlayer] 加载播放器设置失败，使用默认设置:',e),this.useDefaultSettings()}}applySettingsToStore(e){if(!this.piniaInstance)return void this.handleError('应用设置','Pinia 实例未初始化');const a=v(this.piniaInstance);a?.initFromSettings?a.initFromSettings(e):this.handleError('应用设置','Store 或 initFromSettings 方法不存在')}useDefaultSettings(){const e=le.parse({});de.saveSettings(e)}cleanup(){this.playerApp&&(this.playerApp.unmount(),this.playerApp=null),this.container&&(this.container.remove(),this.container=null),this.piniaInstance=null,$('head style[data-aplayer]').remove(),$(document).off('click.aplayerVue')}resetInstance(){se.instance=null}bindGlobalEvents(){$(document).on('click.aplayerVue',this.handleOutsideClick),$(window).on('pagehide',()=>this.destroyPlayer())}handleOutsideClick=e=>{$(e.target).closest('#aplayer-container .aplayer-menu, #aplayer-container .aplayer-list').length||this.closePlaylistIfOpen()};closePlaylistIfOpen(){if(this.playerApp?._instance&&this.piniaInstance)try{const e=this.piniaInstance._s,a=e?.get('player');if(a&&!a.listFolded)return void a.toggleList()}catch(e){console.warn('[APlayer] 通过 store 关闭播放列表失败，使用 DOM 操作:',e)}const e=$('#aplayer-container .aplayer-list');e.hasClass('aplayer-list-show')&&e.removeClass('aplayer-list-show')}handleError=_.throttle((e,a)=>{const t=`[APlayer ${e}]: ${a?.message||a}`;console.error(t)},2e3)}const de={findStyleElement:_.memoize(e=>$(`head > style:contains("[${e}]")`,document)),saveSettings:_.debounce(e=>{replaceVariables(e,{type:'script',script_id:getScriptId()})},500),processSettings:_.flow([e=>{return a=e,le.parse(a);var a},e=>(de.saveSettings(e),e)]),logError:_.throttle((e,a)=>{console.error(`[APlayer] ${e}:`,a)},1e3)};let pe;const ce=(e=c)=>{pe=se.getInstance(),pe.createPlayer(e)},ue=()=>{pe&&pe.destroyPlayer()},me=_.debounce(()=>{ce()},1e3,{leading:!1,trailing:!0,maxWait:2e3});$(()=>{eventOn(tavern_events.APP_READY,me)});export{ce as createMusicPlayer,ue as destroyMusicPlayer};