const e=!0;function t(t,...i){e&&console.log(`[MVU Filter] ${t}`,...i)}function i(e){try{const i=Mvu.getMvuData({type:'chat'}),r=/_\.set\s*\(\s*([^,]+)\s*,\s*[^)]+\)\s*;?\s*(?:\/\/.*)?/g;let n=0;const a=e.replace(r,(e,r)=>{try{const s=function(e){let t=e.trim();return(t.startsWith('"')&&t.endsWith('"')||t.startsWith('\'')&&t.endsWith('\''))&&(t=t.slice(1,-1)),t}(r);t(`Checking variable path: "${s}"`);const o=function(e,i){try{return _.get(e.stat_data,i)}catch(e){return void t(`Failed to get variable value: ${i}`,e)}}(i,s);return void 0===o?(t(`Variable does not exist, keeping command: ${s}`),e):null==(a=o)||!Array.isArray(a)&&'object'!=typeof a?(t(`Simple variable update, keeping: "${s}" (${typeof o})`),e):(t(`Found complex variable update command, removing: "${s}"`,{currentValue:o,valueType:Array.isArray(o)?'array':'object',command:e.trim()}),n++,'')}catch(i){return t(`Error parsing command, keeping original: ${e.trim()}`,i),e}var a});return n>0&&toastr.info(`已删除 ${n} 个不合规的 _.set 复杂变量更新命令`),a}catch(i){return t('Serious error during filtering process, returning original text',i),e}}$(()=>{t('MVU variable update restriction script starting...'),waitGlobalInitialized('Mvu').then(()=>{t('MVU framework initialized, setting up filter'),t('Initializing message interception event listeners...'),eventMakeFirst(tavern_events.MESSAGE_RECEIVED,async e=>{try{t(`Intercepted message: ${e}`);const r=getChatMessages(e);if(!r||0===r.length)return void t(`Message ${e} does not exist or is empty`);const n=r[0].message;if(!n||''===n.trim())return void t(`Message ${e} content is empty, skipping processing`);const a=i(n);a!==n?(t(`Message ${e} content filtered, updating...`),await setChatMessages([{message_id:e,message:a}],{refresh:'none'}),t(`Message ${e} update completed`)):t(`Message ${e} needs no filtering`)}catch(i){t(`Error processing message ${e}:`,i)}}),t('Event listeners initialization completed'),t('MVU variable update restriction script startup completed')}).catch(e=>{t('Error waiting for MVU initialization:',e)})}),$(window).on('pagehide',()=>{t('MVU variable update restriction script unloaded')});
//# sourceMappingURL=index.js.map