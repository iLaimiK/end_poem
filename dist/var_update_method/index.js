const o=z,e=o.z.enum(['额外模型解析','随AI输出']),t=o.z.object({worldbookName:o.z.string(),extraModelParseEntries:o.z.array(o.z.string()),aiOutputEntry:o.z.string()}),n=o.z.object({更新方式:e.optional()}),r=t.parse({worldbookName:'终焉之诗',extraModelParseEntries:['[mvu_update]output_format','[mvu_plot]output_format'],aiOutputEntry:'output_format'});function a(){try{const e=_.get(SillyTavern.extensionSettings,'mvu_settings',{}),t=n.safeParse(e);return t.success?t.data.更新方式:void console.log('[MVU 更新方式切换] MVU 设置格式错误:',o.z.prettifyError(t.error))}catch(o){return void console.log('[MVU 更新方式切换] 获取 MVU 更新方式失败',o)}}async function l(){try{const o=a();if(!o)return void console.log('[MVU 更新方式切换] 未找到 MVU 更新方式设置，跳过处理');console.log(`[MVU 更新方式切换] 当前 MVU 更新方式: ${o}`);const e=await getWorldbook(r.worldbookName);if(!e||0===e.length)return console.log(`[MVU 更新方式切换] 世界书 "${r.worldbookName}" 不存在或为空`),void toastr.warning(`世界书 "${r.worldbookName}" 不存在`);let t,n;switch(o){case'额外模型解析':t=r.extraModelParseEntries,n=[r.aiOutputEntry];break;case'随AI输出':t=[r.aiOutputEntry],n=r.extraModelParseEntries;break;default:return}console.log('[MVU 更新方式切换] 准备更新条目状态',{entriesToEnable:t,entriesToDisable:n});const l=e.map(o=>t.includes(o.name)?(console.log(`[MVU 更新方式切换] 启用条目: ${o.name}`),{...o,enabled:!0}):n.includes(o.name)?(console.log(`[MVU 更新方式切换] 禁用条目: ${o.name}`),{...o,enabled:!1}):o);await replaceWorldbook(r.worldbookName,l,{render:'immediate'}),console.log('[MVU 更新方式切换] 世界书条目状态更新完成'),toastr.success(`已根据 MVU 更新方式 "${o}" 切换世界书条目`)}catch(o){console.log('[MVU 更新方式切换] 切换世界书条目时发生错误',o),toastr.error('切换世界书条目失败')}}$(()=>{console.log('[MVU 更新方式切换] MVU 更新方式切换脚本启动中...'),l().then(()=>{console.log('[MVU 更新方式切换] 初始化世界书条目切换完成'),function(){let o=a();setInterval(async()=>{const e=a();e&&e!==o&&(console.log(`[MVU 更新方式切换] 检测到 MVU 更新方式变化: ${o} -> ${e}`),o=e,await l())},500),console.log('[MVU 更新方式切换] 已启动轮询监听')}(),console.log('[MVU 更新方式切换] 已开始监听 MVU 设置变化')}).catch(o=>{console.log('[MVU 更新方式切换] 初始化失败',o),toastr.error('MVU 更新方式切换脚本启动失败')})}),$(window).on('pagehide',()=>{console.log('[MVU 更新方式切换] MVU 更新方式切换脚本已卸载')});
//# sourceMappingURL=index.js.map